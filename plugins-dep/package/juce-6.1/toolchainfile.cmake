# Aide juceaide in MOD builds

set(HOST_DIR "$ENV{HOST_DIR}")
get_filename_component(TARGET_DIR "${HOST_DIR}/../target" REALPATH)

include("${HOST_DIR}/usr/share/buildroot/toolchainfile.cmake")

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_ALSA=0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_JACK=0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_AUDIOPROCESSOR_NO_GUI=1")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_DSP_ENABLE_SNAP_TO_ZERO=0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_DSP_USE_SHARED_FFTW=1")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_USE_CURL=0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_USE_XCURSOR=0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_USE_XINERAMA=0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_USE_XRANDR=0")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DJUCE_USE_XSHM=0")

if(JUCE_BUILD_HELPER_TOOLS)
  set(CMAKE_PROGRAM_PATH "${HOST_DIR}/usr/bin")
  set(CMAKE_FIND_ROOT_PATH "${HOST_DIR}")
  set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM ONLY)
  set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)
  set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
  set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
  set(ENV{PKG_CONFIG_SYSROOT_DIR} "${HOST_DIR}")
  set(ENV{PKG_CONFIG_PATH} "${HOST_DIR}/usr/lib/pkgconfig")
else()
  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -ffat-lto-objects")
endif()

if(CMAKE_SYSTEM_PROCESSOR STREQUAL "aarch64")
  set(CROSSCOMPILING TRUE)
  set(CROSSCOMPILING_EMULATOR qemu-aarch64-static -L "${TARGET_DIR}")
  separate_arguments(CMAKE_CROSSCOMPILING_EMULATOR)
elseif(CMAKE_SYSTEM_PROCESSOR STREQUAL "armv7l")
  set(CROSSCOMPILING TRUE)
  set(CROSSCOMPILING_EMULATOR qemu-arm-static -L "${TARGET_DIR}")
  separate_arguments(CMAKE_CROSSCOMPILING_EMULATOR)
endif()

set(JUCE_AUDIOPROCESSOR_NO_GUI TRUE)
set(JUCE_MOD_BUILD TRUE)
